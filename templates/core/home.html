{% extends 'base.html' %}
{% block content %}
{% load static %}
<section class="hero">
    <article class="hero-box profile-hero">
        <h2>Hello, {{ user.username }}</h2>
        <div class="profile-quick">
            <img src="{% if profile.avatar %}{{ profile.avatar.url }}{% else %}{% static 'images/default-avatar.svg' %}{% endif %}" alt="Profile avatar" class="avatar-lg">
            <div>
                <p class="media-meta">Manage your profile photo right here.</p>
                <form method="post" enctype="multipart/form-data" class="inline-form">
                    {% csrf_token %}
                    {{ avatar_form.avatar }}
                    <button type="submit" name="upload_avatar">Upload Photo</button>
                    <button type="submit" name="delete_avatar" class="delete-btn">Delete Photo</button>
                </form>
                <a href="{% url 'profile' %}" class="btn">Edit name, email, password</a>
            </div>
        </div>
    </article>
</section>

<section class="hero">
    <article class="hero-box">
        <h2>Best Movie</h2>
        {% if top_movie %}
            <div class="media-row">
                <img src="{{ top_movie.poster_source }}" alt="{{ top_movie.title }} poster" class="poster-thumb">
                <div>
                    <h3>{{ top_movie.title }}</h3>
                    <p>{{ top_movie.production_year }} â€¢ {{ top_movie.country.flag_emoji }} {{ top_movie.country.name }}</p>
                    <p class="score">Score: {{ top_movie.score }}/100</p>
                </div>
            </div>
        {% else %}
            <p>No movie saved yet. Add your first movie below.</p>
        {% endif %}
    </article>

    <article class="hero-box">
        <h2>Best Actor</h2>
        {% if top_actor %}
            <div class="media-row">
                <img src="{{ top_actor.poster_source }}" alt="{{ top_actor.full_name }} poster" class="poster-thumb">
                <div>
                    <h3>{{ top_actor.full_name }}</h3>
                    <p>{{ top_actor.country.flag_emoji }} {{ top_actor.country.name }}</p>
                    <p class="score">Score: {{ top_actor.score }}/100</p>
                </div>
            </div>
        {% else %}
            <p>No actor saved yet. Add your first actor below.</p>
        {% endif %}
    </article>
</section>

<section class="entry-grid">
    <article class="entry-card movie-card">
        <h2>Add Movie</h2>
        <form method="post" enctype="multipart/form-data" class="stack-form">
            {% csrf_token %}
            {% for field in movie_form %}
                <div class="field-group">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field }}
                    {% for error in field.errors %}
                        <small class="error">{{ error }}</small>
                    {% endfor %}
                </div>
            {% endfor %}
            <button type="submit" name="add_movie">Save Movie</button>
        </form>
    </article>

    <article class="entry-card actor-card">
        <h2>Add Actor</h2>
        <form method="post" enctype="multipart/form-data" class="stack-form">
            {% csrf_token %}
            {% for field in actor_form %}
                <div class="field-group">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field }}
                    {% for error in field.errors %}
                        <small class="error">{{ error }}</small>
                    {% endfor %}
                </div>
            {% endfor %}
            <button type="submit" name="add_actor">Save Actor</button>
        </form>
    </article>
</section>

<section class="filter-grid">
    <article class="filter-card">
        <h3>Movie Country Filter</h3>
        <form method="get" class="stack-form">
            <input type="hidden" name="actor_country" value="{{ actor_country }}">
            <input type="text" name="movie_country" class="country-select" placeholder="Type country name" value="{{ movie_country }}" autocomplete="off">
            <button type="submit">Apply Movie Filter</button>
        </form>
    </article>

    <article class="filter-card">
        <h3>Actor Country Filter</h3>
        <form method="get" class="stack-form">
            <input type="hidden" name="movie_country" value="{{ movie_country }}">
            <input type="text" name="actor_country" class="country-select" placeholder="Type country name" value="{{ actor_country }}" autocomplete="off">
            <button type="submit">Apply Actor Filter</button>
        </form>
    </article>
</section>

<section class="rankings">
    <div>
        <h2>Your Movie List</h2>
        <ol class="media-list">
            {% for movie in movies_ranked %}
                <li>
                    <img src="{{ movie.poster_source }}" alt="{{ movie.title }} poster" class="list-poster">
                    <div class="item-body">
                        <div>
                            <strong>{{ movie.title }}</strong>
                            <p>{{ movie.production_year }} â€¢ {{ movie.country.flag_emoji }} {{ movie.country.name }}</p>
                            <p class="score">Score: {{ movie.score }}/100</p>
                        </div>
                        <form method="post" class="delete-form">
                            {% csrf_token %}
                            <button type="submit" name="delete_movie" value="{{ movie.id }}" class="delete-btn" aria-label="Delete {{ movie.title }}">ðŸ—‘</button>
                        </form>
                    </div>
                </li>
            {% empty %}
                <li>No movies saved yet.</li>
            {% endfor %}
        </ol>
    </div>

    <div>
        <h2>Your Actor List</h2>
        <ol class="media-list">
            {% for actor in actors_ranked %}
                <li>
                    <img src="{{ actor.poster_source }}" alt="{{ actor.full_name }} poster" class="list-poster">
                    <div class="item-body">
                        <div>
                            <strong>{{ actor.full_name }}</strong>
                            <p>Born {{ actor.production_year }} â€¢ {{ actor.country.flag_emoji }} {{ actor.country.name }}</p>
                            <p class="score">Age: {{ actor.age }}</p>
                        </div>
                        <form method="post" class="delete-form">
                            {% csrf_token %}
                            <button type="submit" name="delete_actor" value="{{ actor.id }}" class="delete-btn" aria-label="Delete {{ actor.full_name }}">ðŸ—‘</button>
                        </form>
                    </div>
                </li>
            {% empty %}
                <li>No actors saved yet.</li>
            {% endfor %}
        </ol>
    </div>
</section>
{% endblock %}