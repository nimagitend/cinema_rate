{% extends 'base.html' %}
{% block content %}
<section class="hero">
    <article class="hero-box">
        <h2>Best Movie</h2>
        {% if top_movie %}
            <div class="media-row">
                <img src="{{ top_movie.poster_source }}" alt="{{ top_movie.title }} poster" class="poster-thumb">
                <div>
                    <h3>{{ top_movie.title }}</h3>
                    <p>{{ top_movie.production_year }} • {{ top_movie.country.flag_emoji }} {{ top_movie.country.name }}</p>
                    <p class="score">Score: {{ top_movie.score }}/100</p>
                </div>
            </div>
        {% else %}
            <p>No movie saved yet. Add your first movie below.</p>
        {% endif %}
    </article>

    <article class="hero-box">
        <h2>Best Actor</h2>
        {% if top_actor %}
            <div class="media-row">
                <img src="{{ top_actor.poster_source }}" alt="{{ top_actor.full_name }} poster" class="poster-thumb">
                <div>
                    <h3>{{ top_actor.full_name }}</h3>
                    <p>{{ top_actor.production_year }} • {{ top_actor.country.flag_emoji }} {{ top_actor.country.name }}</p>
                    <p class="score">Score: {{ top_actor.score }}/100</p>
                </div>
            </div>
        {% else %}
            <p>No actor saved yet. Add your first actor below.</p>
        {% endif %}
    </article>
</section>

<section class="entry-grid">
    <article class="entry-card">
        <h2>Add Movie</h2>
        <form method="post" enctype="multipart/form-data" class="stack-form">
            {% csrf_token %}
            {% for field in movie_form %}
                <div class="field-group">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field }}
                    {% if field.name == 'country' %}
                        <datalist id="movie-country-options">
                            {% for country in field.field.queryset %}
                                <option value="{{ country.name }}">{{ country.flag_emoji }} {{ country.name }}</option>
                            {% endfor %}
                        </datalist>
                    {% endif %}
                    {% for error in field.errors %}
                        <small class="error">{{ error }}</small>
                    {% endfor %}
                </div>
            {% endfor %}
            <button type="submit" name="add_movie">Save Movie</button>
        </form>
    </article>

    <article class="entry-card">
        <h2>Add Actor</h2>
        <form method="post" enctype="multipart/form-data" class="stack-form">
            {% csrf_token %}
            {% for field in actor_form %}
                <div class="field-group">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field }}
                    {% if field.name == 'country' %}
                        <datalist id="actor-country-options">
                            {% for country in field.field.queryset %}
                                <option value="{{ country.name }}">{{ country.flag_emoji }} {{ country.name }}</option>
                            {% endfor %}
                        </datalist>
                    {% endif %}
                    {% for error in field.errors %}
                        <small class="error">{{ error }}</small>
                    {% endfor %}
                </div>
            {% endfor %}
            <button type="submit" name="add_actor">Save Actor</button>
        </form>
    </article>
</section>

<section class="filter-grid">
    <article class="filter-card">
        <h3>Movie Country Filter</h3>
        <form method="get" class="stack-form">
            <input type="hidden" name="actor_country" value="{{ actor_country }}">
            <input type="text" name="movie_country" class="country-select" list="movie-filter-country-options" placeholder="Type country name" value="{{ movie_country }}" autocomplete="off">
            <datalist id="movie-filter-country-options">
                {% for country in countries %}
                    <option value="{{ country.name }}">{{ country.flag_emoji }} {{ country.name }}</option>
                {% endfor %}
            </datalist>
            <button type="submit">Apply Movie Filter</button>
        </form>
    </article>

    <article class="filter-card">
        <h3>Actor Country Filter</h3>
        <form method="get" class="stack-form">
            <input type="hidden" name="movie_country" value="{{ movie_country }}">
            <input type="text" name="actor_country" class="country-select" list="actor-filter-country-options" placeholder="Type country name" value="{{ actor_country }}" autocomplete="off">
            <datalist id="actor-filter-country-options">
                {% for country in countries %}
                    <option value="{{ country.name }}">{{ country.flag_emoji }} {{ country.name }}</option>
                {% endfor %}
            </datalist>
            <button type="submit">Apply Actor Filter</button>
        </form>
    </article>
</section>

<section class="rankings">
    <div>
        <h2>Your Movie List</h2>
        <ol class="media-list">
            {% for movie in movies_ranked %}
                <li>
                    <img src="{{ movie.poster_source }}" alt="{{ movie.title }} poster" class="list-poster">
                    <div>
                        <strong>{{ movie.title }}</strong>
                        <p>{{ movie.production_year }} • {{ movie.country.flag_emoji }} {{ movie.country.name }}</p>
                        <p class="score">Score: {{ movie.score }}/100</p>
                    </div>
                </li>
            {% empty %}
                <li>No movies saved yet.</li>
            {% endfor %}
        </ol>
    </div>

    <div>
        <h2>Your Actor List</h2>
        <ol class="media-list">
            {% for actor in actors_ranked %}
                <li>
                    <img src="{{ actor.poster_source }}" alt="{{ actor.full_name }} poster" class="list-poster">
                    <div>
                        <strong>{{ actor.full_name }}</strong>
                        <p>{{ actor.production_year }} • {{ actor.country.flag_emoji }} {{ actor.country.name }}</p>
                        <p class="score">Score: {{ actor.score }}/100</p>
                    </div>
                </li>
            {% empty %}
                <li>No actors saved yet.</li>
            {% endfor %}
        </ol>
    </div>
</section>
{% endblock %}